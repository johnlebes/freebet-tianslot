<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FREEBET TIANSLOT</title>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  color:#fff;
  padding:24px;
  background:
  linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
  url("https://i.imgur.com/orW2qU0.png") center/cover no-repeat fixed;
}
.wrap{max-width:1100px;margin:auto}
.card{
  background:rgba(10,15,25,.85);
  border-radius:16px;
  overflow:hidden;
}
.titlebar{
  padding:18px;text-align:center;position:relative;
}
.admin{
  position:absolute;right:15px;top:15px;cursor:pointer;
  background:#222;padding:6px 10px;border-radius:8px;
}
.countdown{text-align:center;padding:30px}
.timer{font-size:56px;font-weight:bold}
.admin-panel{display:none;text-align:center;padding:15px}
.admin-panel input{padding:8px;margin:5px}
button{padding:8px 12px;margin:4px;border-radius:6px;border:none;cursor:pointer}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #333;text-align:center}
</style>
</head>

<body>
<div class="wrap">
<div class="card">

<div class="titlebar">
  <div class="admin" onclick="toggleAdmin()">ðŸ”’</div>
  <h1>FREEBET TIANSLOT</h1>
</div>

<div id="adminPanel" class="admin-panel">
  <input id="pin" type="password" placeholder="PIN">
  <input id="jam" type="number" placeholder="Durasi jam">
  <button onclick="setDurasi()">SET DURASI GLOBAL</button>
  <button onclick="editTable()">EDIT TABEL</button>
</div>

<div id="countdownBox" class="countdown">
  <div>INFO FREEBET AKAN DIBUKA DALAM</div>
  <div id="timer" class="timer">00:00:00</div>
</div>

<div id="kontenTabel" style="display:none">
  <table>
    <thead>
      <tr>
        <th>#</th><th>USER</th><th>BONUS</th><th>KODE</th><th>POLA</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

</div>
</div>

<script>
const API="/.netlify/functions/timer";
let target=0, table=[];

function pad(x){return String(x).padStart(2,'0');}

// ambil data dari server
async function fetchAll(){
  const r=await fetch(API);
  const d=await r.json();
  target=d.targetTime;
  table=d.tableData;
  renderTable();
}

function renderTable(){
  const tb=document.getElementById("tbody");
  tb.innerHTML="";
  table.forEach((r,i)=>{
    tb.innerHTML+=`
    <tr>
      <td>${i+1}</td>
      <td>${r.user}</td>
      <td>${r.bonus.toLocaleString('id-ID')}</td>
      <td>${r.kode}</td>
      <td>KLIK "KLAIM DISINI"</td>
    </tr>`;
  });
}

function tick(){
  const s=Math.floor((target-Date.now())/1000);
  if(s<=0){
    document.getElementById("countdownBox").style.display="none";
    document.getElementById("kontenTabel").style.display="block";
  }else{
    const h=Math.floor(s/3600);
    const m=Math.floor((s%3600)/60);
    const d=s%60;
    document.getElementById("timer").innerText=`${pad(h)}:${pad(m)}:${pad(d)}`;
  }
}

setInterval(async()=>{await fetchAll();tick();},1000);

// ===== ADMIN =====
function toggleAdmin(){
  const p=document.getElementById("adminPanel");
  p.style.display=p.style.display==="block"?"none":"block";
}

async function setDurasi(){
  const pin=document.getElementById("pin").value;
  const jam=parseInt(document.getElementById("jam").value);
  const newTarget=Date.now()+jam*60*60*1000;

  await fetch(API,{
    method:"POST",
    body:JSON.stringify({pin,newTarget})
  });

  alert("Durasi GLOBAL diubah!");
}

async function editTable(){
  const pin=document.getElementById("pin").value;
  let baru=[];
  for(let i=0;i<table.length;i++){
    const user=prompt("User "+(i+1), table[i].user);
    const bonus=parseInt(prompt("Bonus "+(i+1), table[i].bonus));
    const kode=prompt("Kode "+(i+1), table[i].kode);
    baru.push({user,bonus,kode});
  }

  await fetch(API,{
    method:"POST",
    body:JSON.stringify({pin,newTable:baru})
  });

  alert("Tabel GLOBAL diupdate!");
}
</script>

</body>
</html>
